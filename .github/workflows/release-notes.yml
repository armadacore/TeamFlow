name: Release notes

on:
#  workflow_dispatch:
  push:
    branches:
      - '**'
      - '!master'
      - '!develop'
    tags:
      - 'v*.*.*'

jobs:
  collect-notes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get latest tag
        uses: actions-ecosystem/action-get-latest-tag@v1
        id: get-latest-tag

      - name: Build Changelog
        id: release-notes
        uses: mikepenz/release-changelog-builder-action@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          failOnError: true
          fromTag: ${{ steps.get-latest-tag.outputs.tag }}
          configurationJson: |
            {
            "categories": [
              {
                "key": "features",
                "title": "## üöÄ‚òéÔ∏è Features",
                "labels": ["feature", "feat"]
              },
              {
                "key": "fixes",
                "title": "## üêõ Fixes",
                "labels": ["fix", "bug"]
              },
              {
                "key": "tests",
                "title": "## üß™ Tests",
                "labels": ["test"]
              },
              {
                "key": "documentations",
                "title": "## üìö Documentations",
                "labels": ["documentation", "doc"]
              },
              {
                "key": "chore",
                "title": "## ‚öôÔ∏è Chore",
                "labels": ["chore"]
              },
              {
                "key": "cicd",
                "title": "## üì¶ CICD",
                "labels": ["cicd", "ci"]
              }
            ],
              "ignore_labels": [
                "ignore",
                "release"
              ],
              "template": "#{{CHANGELOG}}\n\n<details>\n<summary>Uncategorized</summary>\n\n#{{UNCATEGORIZED}}\n</details>",
              "pr_template": "- #{{TITLE}}\n   - PR: ##{{NUMBER}}",
              "max_tags_to_fetch": 200,
              "max_pull_requests": 200,
              "max_back_track_time_days": 365,
              "exclude_merge_branches": [
                "Owner/qa"
              ],
              "base_branches": [
                "develop"
              ]
            }

      - name: Output notes
        run: |
          echo "${{ steps.release-notes.outputs.changelog }}"
